<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhà Sách Trực Tuyến Nâng Cao</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="p-3 mb-3 border-bottom bg-white shadow-sm sticky-top">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-dark text-decoration-none me-lg-4">
                    <i class="fas fa-book-open fa-2x text-primary"></i>
                    <span class="fs-4 ms-2">BookStore</span>
                </a>

                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="#" class="nav-link px-2 link-secondary">Trang chủ</a></li>
                    <li><a href="#book-list-section" class="nav-link px-2 link-dark">Sản phẩm</a></li>
                    <li><a href="#deals-container" class="nav-link px-2 link-dark">Ưu đãi</a></li>
                    <li><a href="#" class="nav-link px-2 link-dark">Giới thiệu</a></li>
                </ul>

                <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search" id="search-form">
                    <input type="search" id="searchInput" class="form-control" placeholder="Tìm kiếm sách..." aria-label="Search">
                </form>

                <div class="text-end d-flex align-items-center">
                    <button type="button" class="btn btn-outline-danger me-2 position-relative" data-bs-toggle="modal" data-bs-target="#wishlistModal" id="wishlist-btn-header">
                        <i class="fas fa-heart"></i>
                        <span id="wishlist-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            0
                            <span class="visually-hidden">sản phẩm yêu thích</span>
                        </span>
                    </button>

                    <button type="button" class="btn btn-outline-primary me-3 position-relative" data-bs-toggle="modal" data-bs-target="#cartModal" id="cart-btn-header">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary">
                            0
                            <span class="visually-hidden">sản phẩm trong giỏ</span>
                        </span>
                    </button>

                    <div class="d-flex align-items-center">
                        <div id="auth-buttons">
                            <button type="button" class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">Đăng nhập</button>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registerModal">Đăng ký</button>
                        </div>
                        <div id="user-greeting" class="d-none align-items-center">
                             <span class="me-3">Chào, <strong id="username-display">User</strong>!</span>
                             <button id="profile-button" class="btn btn-link btn-sm ms-2 p-0 me-2" data-bs-toggle="modal" data-bs-target="#profileModal" title="Tài khoản"><i class="fas fa-user-circle fa-lg"></i></button>
                             <button id="logout-button" class="btn btn-outline-secondary btn-sm">Đăng xuất</button>
                        </div>
                     </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mt-4">

        <section class="my-5 text-center">
             <h1 class="display-5 fw-bold">Chào mừng đến với BookStore!</h1>
             <p class="lead text-muted">Khám phá thế giới tri thức và những câu chuyện hấp dẫn.</p>
             <a href="#book-list-section" class="btn btn-primary btn-lg">Khám phá ngay</a>
        </section>

        <section class="container my-5">
            <h2 class="mb-4 text-center">Sách Mới Nhất</h2>
            <div id="newest-books-container" class="row g-4">
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
                 <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
                 <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
                 <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
            </div>
        </section>

        <section class="container my-5 bg-light p-4 rounded">
            <h2 class="mb-4 text-center">Sách Bán Chạy Nhất</h2>
             <p class="text-center text-muted mb-4">(Dựa trên đánh giá cao nhất)</p>
            <div id="best-sellers-container" class="row g-4">
                 <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
                 <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
            </div>
        </section>

        <section class="container my-5" id="deals-section">
            <h2 class="mb-4 text-center text-danger">Ưu đãi Hôm Nay <i class="fas fa-bolt"></i></h2>
            <div id="deals-container" class="row g-4">
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4 book-card-wrapper"><div class="card h-100 book-card loading-skeleton"><div class="loading-skeleton-img"></div><div class="card-body"><div class="loading-skeleton-text"></div><div class="loading-skeleton-text loading-skeleton-text-short"></div></div></div></div>
            </div>
        </section>

        <section id="book-list-section" class="my-5">
            <h2 class="mb-4">Tất cả sách</h2>

            <div class="row mb-4 gy-3 align-items-center">
                <div class="col-md-4">
                    <label for="genreFilter" class="form-label">Lọc theo thể loại:</label>
                    <select id="genreFilter" class="form-select">
                        <option value="">Tất cả thể loại</option>
                        </select>
                </div>
                <div class="col-md-4">
                    <label for="sortOptions" class="form-label">Sắp xếp theo:</label>
                    <select id="sortOptions" class="form-select">
                        <option value="default">Mặc định</option>
                        <option value="priceAsc">Giá tăng dần</option>
                        <option value="priceDesc">Giá giảm dần</option>
                        <option value="ratingDesc">Đánh giá cao nhất</option>
                        <option value="nameAsc">Tên A-Z</option>
                         <option value="nameDesc">Tên Z-A</option>
                         <option value="newest">Mới nhất</option>
                    </select>
                </div>
                <div class="col-md-4 text-md-end">
                     <span id="book-count-display">Hiển thị 0 sách</span>
                </div>
            </div>

            <div id="book-list" class="row g-4">
                <div id="loading-indicator" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>

            <nav aria-label="Page navigation" class="mt-5 d-flex justify-content-center">
                <ul id="pagination" class="pagination">
                    </ul>
            </nav>
        </section>

    </main>

    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2025 BookStore Nâng Cao. Phát triển bởi Gemini & Bạn.</p>
            <p>
                <a href="#" class="text-white-50 me-3">Chính sách bảo mật</a>
                <a href="#" class="text-white-50 me-3">Điều khoản sử dụng</a>
                <a href="#" class="text-white-50">Liên hệ</a>
            </p>
        </div>
    </footer>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Đăng nhập</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="login-form">
              <div class="mb-3">
                <label for="login-username" class="form-label">Tên đăng nhập</label>
                <input type="text" class="form-control" id="login-username" required>
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">Mật khẩu</label>
                <input type="password" class="form-control" id="login-password" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
            </form>
            <p class="mt-3 text-center">Chưa có tài khoản? <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerModal">Đăng ký ngay</a></p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
       <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="registerModalLabel">Đăng ký tài khoản</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="register-form">
               <div class="mb-3">
                 <label for="register-username" class="form-label">Tên đăng nhập</label>
                 <input type="text" class="form-control" id="register-username" required>
               </div>
                <div class="mb-3">
                 <label for="register-email" class="form-label">Email</label>
                 <input type="email" class="form-control" id="register-email" required>
               </div>
               <div class="mb-3">
                 <label for="register-password" class="form-label">Mật khẩu</label>
                 <input type="password" class="form-control" id="register-password" required>
               </div>
               <button type="submit" class="btn btn-success w-100">Đăng ký</button>
            </form>
             <p class="mt-3 text-center">Đã có tài khoản? <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#loginModal">Đăng nhập</a></p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable"> {/* Added modal-dialog-scrollable */}
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="profileModalLabel">Thông tin tài khoản</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
             <ul class="nav nav-tabs" id="profileTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="history-tab" data-bs-toggle="tab" data-bs-target="#order-history-tab-pane" type="button" role="tab" aria-controls="order-history-tab-pane" aria-selected="true">Lịch sử Đơn hàng</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="challenge-tab" data-bs-toggle="tab" data-bs-target="#reading-challenge-tab-pane" type="button" role="tab" aria-controls="reading-challenge-tab-pane" aria-selected="false">Thử thách Đọc sách</button>
              </li>
               <li class="nav-item" role="presentation">
                <button class="nav-link" id="info-tab" data-bs-toggle="tab" data-bs-target="#user-info-tab-pane" type="button" role="tab" aria-controls="user-info-tab-pane" aria-selected="false">Thông tin Cá nhân</button>
              </li>
            </ul>

            <div class="tab-content pt-3" id="profileTabContent">
              <div class="tab-pane fade show active" id="order-history-tab-pane" role="tabpanel" aria-labelledby="history-tab" tabindex="0">
                <h4>Lịch sử Đơn hàng</h4>
                <div id="order-history-container">
                    <p class="text-muted">Vui lòng đăng nhập để xem lịch sử.</p>
                </div>
              </div>
              <div class="tab-pane fade" id="reading-challenge-tab-pane" role="tabpanel" aria-labelledby="challenge-tab" tabindex="0">
                 <h4>Thử thách Đọc sách</h4>
                 <div id="reading-challenge-container">
                     <p class="text-muted">Vui lòng đăng nhập để tham gia thử thách.</p>
                 </div>
              </div>
               <div class="tab-pane fade" id="user-info-tab-pane" role="tabpanel" aria-labelledby="info-tab" tabindex="0">
                 <h4>Thông tin Cá nhân</h4>
                 <p><strong>Tên đăng nhập:</strong> <span id="profile-username" class="text-primary">N/A</span></p>
                 <p><strong>Email:</strong> <span id="profile-email" class="text-primary">N/A</span></p>
                 <p class="text-muted small">Lưu ý: Thông tin này được lưu trữ cục bộ trên trình duyệt của bạn (mô phỏng).</p>
                 {/* Thêm các thông tin khác nếu có */}
              </div>
            </div>
          </div>
           <div class="modal-footer">
             <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
           </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">Giỏ hàng của bạn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cart-items-container">
                        <p class="text-center text-muted">Giỏ hàng trống.</p>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                     <div>
                         <button id="clear-cart-btn" class="btn btn-outline-danger">Xóa hết</button>
                     </div>
                     <div>
                         <span class="fw-bold me-3">Tổng cộng: <span id="cart-total">0 VND</span></span>
                         <button id="checkout-button" type="button" class="btn btn-success">Thanh toán</button>
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="wishlistModal" tabindex="-1" aria-labelledby="wishlistModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="wishlistModalLabel">Danh sách Yêu thích</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="wishlist-items-container">
                        <p class="text-center text-muted">Danh sách yêu thích trống.</p>
                    </div>
                </div>
                 <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                 </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="bookDetailModal" tabindex="-1" aria-labelledby="bookDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookDetailTitle">Chi tiết sách</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <img id="bookDetailImage" src="img/placeholder.png" alt="Bìa sách" class="img-fluid rounded mb-3" style="max-height: 300px;">
                        </div>
                        <div class="col-md-8">
                            <h3 id="bookDetailModalLabel" class="d-none">Tên Sách</h3> {/* Tiêu đề chính ở đây */}
                            <p class="text-muted mb-1"><strong class="text-dark">Tác giả:</strong> <span id="bookDetailAuthor">N/A</span></p>
                            <p class="text-muted mb-2"><strong class="text-dark">Thể loại:</strong> <span id="bookDetailGenre">N/A</span></p>
                            <div class="mb-3" id="bookDetailPriceContainer">
                                <strong class="text-dark">Giá:</strong> <span id="bookDetailPrice" class="fs-5">0 VND</span>
                            </div>
                             <p id="bookDetailDescription">Mô tả sách...</p>

                             {/* Action buttons */}
                             <div class="d-flex align-items-center flex-wrap gap-2 mb-3">
                                 <button id="detail-add-to-cart-btn" class="btn btn-primary"><i class="fas fa-cart-plus me-1"></i> Thêm vào giỏ</button>
                                 <button id="detail-wishlist-btn" class="btn btn-outline-danger"><i class="far fa-heart me-1"></i> Yêu thích</button>
                                 {/* Nút Đã đọc (cho challenge) */}
                                  <button id="detail-mark-read-btn" class="btn btn-outline-success"><i class="fas fa-check-circle me-1"></i> Đánh dấu Đã đọc</button>
                             </div>
                        </div>
                    </div>

                    <hr>
                    {/* Review Section */}
                    <h4>Đánh giá sản phẩm</h4>
                    <div class="mb-3 d-flex align-items-center">
                        <strong class="me-2">Đánh giá trung bình:</strong>
                        <span id="average-rating-stars" class="me-2"></span>
                        <span id="average-rating">Chưa có đánh giá</span>
                    </div>
                    <div id="reviews-list" class="mb-4 border rounded p-3 bg-light" style="max-height: 250px; overflow-y: auto;">
                        {/* Đánh giá sẽ được render vào đây */}
                        <p class="text-muted">Chưa có đánh giá nào cho sản phẩm này.</p>
                    </div>

                    {/* Review Form */}
                    <div id="review-form-container" class="border p-3 rounded">
                        <h5>Viết đánh giá của bạn</h5>
                        <form id="review-form" data-book-id="">
                            <div class="mb-3">
                                <label class="form-label d-block">Bạn đánh giá:</label> {/* d-block */}
                                <div class="star-rating">
                                    <input type="radio" id="star5" name="rating" value="5" required/><label for="star5" title="5 sao"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 sao"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 sao"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 sao"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 sao"><i class="fas fa-star"></i></label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="review-comment" class="form-label">Bình luận:</label>
                                <textarea class="form-control" id="review-comment" rows="3" required placeholder="Chia sẻ cảm nhận của bạn..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-success" id="submit-review-btn">Gửi đánh giá</button>
                        </form>
                         <p id="review-login-prompt" class="text-danger mt-2 d-none">Vui lòng <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#loginModal">đăng nhập</a> để viết đánh giá.</p>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>


    <div id="chatbot-container" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
        <button id="chatbot-toggle-btn" class="btn btn-primary btn-lg rounded-circle shadow" type="button" data-bs-toggle="collapse" data-bs-target="#chatbot-window" aria-expanded="false" aria-controls="chatbot-window">
            <i class="fas fa-comments"></i>
        </button>
        <div class="collapse" id="chatbot-window">
            <div class="card shadow mt-2" style="width: 350px;">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-robot me-2"></i> Chat với Bot
                     <button type="button" class="btn-close btn-close-white float-end" aria-label="Close" onclick="document.getElementById('chatbot-toggle-btn').click()"></button> {/* Nút đóng */}
                </div>
                <div class="card-body">
                    <div id="chatbox-messages" style="height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; background-color: #f9f9f9; border-radius: 5px;">
                        {/* Tin nhắn chào mừng có thể thêm bằng JS */}
                    </div>
                    <div id="typing-indicator" class="typing-indicator mb-2" style="display: none;">
                        <span></span><span></span><span></span>
                    </div>
                    <div class="input-group">
                        <input type="text" id="chatbox-input" class="form-control" placeholder="Hỏi tôi về sách...">
                        <button id="chatbox-send-btn" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
                    </div>
                    <small class="text-muted d-block mt-1">Bot có thể trả lời về sách, thời gian, và phép tính đơn giản.</small>
                </div>
            </div>
        </div>
    </div>

     <div class="toast-container position-fixed bottom-0 end-0 p-3">
        {/* Toasts sẽ được thêm vào đây bằng JS */}
     </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="script.js"></script>
</body>
</html>
